1
00:00:12,921 --> 00:00:13,921
大家好

2
00:00:13,952 --> 00:00:17,308
這個章節跟大家介紹資料的整併

3
00:00:17,333 --> 00:00:19,538
我們在資料處理的過程中

4
00:00:19,563 --> 00:00:21,811
他們來源可能是有很多

5
00:00:21,836 --> 00:00:22,864
不同的表格

6
00:00:22,889 --> 00:00:25,814
那因為我要整體性的來去做分析

7
00:00:25,839 --> 00:00:28,872
所以需要先把資料做一個整併

8
00:00:29,214 --> 00:00:32,420
那整併基礎上大概有兩種方式

9
00:00:32,444 --> 00:00:35,321
一種是橫向 一種是縱向

10
00:00:35,671 --> 00:00:38,238
舉例來說那我們現在有

11
00:00:38,263 --> 00:00:41,070
一個資料的是 104 學年度

12
00:00:41,095 --> 00:00:43,533
每一個人的收入的狀況

13
00:00:43,558 --> 00:00:46,523
還有另外一筆是 105 年度

14
00:00:46,714 --> 00:00:48,293
的收入的狀況

15
00:00:48,328 --> 00:00:51,803
這兩個的資料結構基本上都是一樣

16
00:00:51,828 --> 00:00:54,778
就是他可能有這個人的名字啊

17
00:00:54,803 --> 00:00:56,526
這個人的身分證字號

18
00:00:56,551 --> 00:00:58,991
還有他每個月的薪水等等的

19
00:00:59,016 --> 00:01:01,035
所以他的欄位是一樣的

20
00:01:01,060 --> 00:01:05,034
這時候呢我就可以去做一個縱向的整併

21
00:01:05,059 --> 00:01:08,096
整併以後呢它的欄位還是一樣的

22
00:01:08,121 --> 00:01:11,321
只是說資料的量是變多的

23
00:01:12,600 --> 00:01:15,266
另外一種方式能是做一個橫向

24
00:01:15,291 --> 00:01:19,015
橫向的這個整併我的資料的欄位會變多

25
00:01:19,040 --> 00:01:23,767
例如我這裡有一個 104 年度每一個人的收入

26
00:01:23,792 --> 00:01:28,496
跟他購買咖啡的數量和這個金額

27
00:01:28,521 --> 00:01:32,236
這時候他的欄位名稱就會不一樣

28
00:01:32,418 --> 00:01:35,747
整併以後呢他這個欄位的數量就會變多

29
00:01:35,772 --> 00:01:41,230
但是資料的這個本體基本上是不會變多的

30
00:01:41,245 --> 00:01:44,475
好那這時候我們用的方式就是 merge

31
00:01:44,500 --> 00:01:47,998
所以有 append merge 這兩種模式

32
00:01:49,054 --> 00:01:51,951
那我們明確的來看一個例子

33
00:01:51,976 --> 00:01:55,451
是用成績的例子來跟大家做一個解說

34
00:01:55,476 --> 00:01:58,594
我們這裡有一個 df1 的表格

35
00:01:58,619 --> 00:02:03,809
那它包含 學號 英文 數學 還有物理的這個成績

36
00:02:03,834 --> 00:02:08,432
第一張表的話是有學號 001 一直到 004

37
00:02:09,107 --> 00:02:12,135
第二張表是 005 到 007

38
00:02:12,342 --> 00:02:14,666
那他資料的結構都是一樣的

39
00:02:14,691 --> 00:02:18,479
所以我們這時候是想要做一個縱向的整併

40
00:02:18,504 --> 00:02:20,928
把資料呢把他拉長

41
00:02:20,953 --> 00:02:25,489
所以這個整併以後就會變成是 001 到 007

42
00:02:25,572 --> 00:02:26,910
那各位可以看到

43
00:02:26,947 --> 00:02:29,743
前面的四筆都是來自於 df1

44
00:02:29,909 --> 00:02:32,672
後面的四筆是來自於 df2

45
00:02:35,474 --> 00:02:38,313
那接下來呢是 merge

46
00:02:38,568 --> 00:02:42,803
那一樣呢 這個 df1 跟上面那張表是一樣的

47
00:02:42,828 --> 00:02:45,829
那 df3 的話有點不一樣

48
00:02:45,941 --> 00:02:48,400
那這個地方有學號

49
00:02:48,560 --> 00:02:50,159
那另外加了兩個科目

50
00:02:50,184 --> 00:02:52,660
一個是 cs 電腦的課

51
00:02:52,693 --> 00:02:54,662
另外這個是資料結構的課

52
00:02:54,687 --> 00:02:57,313
所以多了兩個不同的欄位

53
00:02:57,435 --> 00:02:59,685
那這時候我們要把他整併起來

54
00:02:59,710 --> 00:03:01,725
就是產生一個新的表

55
00:03:01,750 --> 00:03:04,385
這個新的表他總共就會

56
00:03:04,685 --> 00:03:08,390
總共有 6 個欄位包含了這個學號總共有 6 個欄位

57
00:03:08,415 --> 00:03:10,364
所以各位可以看到

58
00:03:10,389 --> 00:03:13,365
一樣是學號 001 到 004

59
00:03:13,390 --> 00:03:16,097
但是欄位整個是變多了

60
00:03:18,644 --> 00:03:22,088
好那我們再來看一個觀念叫做

61
00:03:22,120 --> 00:03:23,795
inner 的 merge

62
00:03:23,820 --> 00:03:27,199
這個事實上就是一種交集的觀念

63
00:03:27,533 --> 00:03:29,372
好看看呢這個df1

64
00:03:29,397 --> 00:03:32,966
還是保持剛剛的那一張表格

65
00:03:32,991 --> 00:03:33,991
就是一個學號

66
00:03:34,267 --> 00:03:35,647
三個欄位

67
00:03:35,881 --> 00:03:39,187
那這個 df4 是有一個學號

68
00:03:39,560 --> 00:03:41,472
然後他有一個 cs

69
00:03:41,497 --> 00:03:43,409
英文跟數學

70
00:03:43,497 --> 00:03:45,636
英文跟數學還有學號呢

71
00:03:45,661 --> 00:03:48,710
這個是在 df1 共同有的欄位

72
00:03:48,735 --> 00:03:53,512
但是 cs 是多出來的這個欄位

73
00:03:53,711 --> 00:03:55,266
而且資料的這個內容

74
00:03:55,299 --> 00:03:58,118
也有一些重疊也有一些新增

75
00:03:58,143 --> 00:04:00,060
像這個地方有一個 001

76
00:04:00,124 --> 00:04:02,242
又有一個 008 跟 9

77
00:04:02,341 --> 00:04:06,432
8 跟 9 是左邊沒有的學生資料

78
00:04:06,457 --> 00:04:09,523
那 001 是共同有的資料

79
00:04:09,548 --> 00:04:12,139
這時候我們把這筆資料做 merge

80
00:04:12,172 --> 00:04:14,798
會產生什麼結果呢

81
00:04:15,875 --> 00:04:18,758
這時候他預設會去做一個交集

82
00:04:18,879 --> 00:04:21,926
因為這兩筆資料共同有的都是什麼

83
00:04:21,951 --> 00:04:25,411
都是 001 的這個學生

84
00:04:25,982 --> 00:04:29,069
那 001 呢他的英文數學

85
00:04:29,094 --> 00:04:32,777
物理還有 cs 的成績全部都會

86
00:04:32,802 --> 00:04:34,688
呈現在這個地方

87
00:04:34,713 --> 00:04:36,879
因為我們在做 merge 的時候

88
00:04:36,904 --> 00:04:38,466
他會去看欄位

89
00:04:38,491 --> 00:04:39,831
欄位名稱一樣

90
00:04:39,975 --> 00:04:41,963
欄位名稱一樣都是 id

91
00:04:41,988 --> 00:04:45,751
然後 eng 會 eng 這個地方去做一個比較

92
00:04:45,776 --> 00:04:48,258
math 會跟 math 去做一個比較

93
00:04:48,283 --> 00:04:52,112
這三筆資料都一樣就會把他放進來

94
00:04:52,137 --> 00:04:56,513
然後把 phy 跟 cs 這兩個是

95
00:04:56,538 --> 00:04:59,269
個別在 table 裡面有的

96
00:04:59,294 --> 00:05:00,749
再去把它做一個整併

97
00:05:00,774 --> 00:05:04,678
所以出來的這個表格就變成是這個樣子

98
00:05:06,528 --> 00:05:09,996
那有交集就會有所謂的聯集

99
00:05:10,021 --> 00:05:13,370
那聯集我們叫做 outer 的 merge

100
00:05:13,395 --> 00:05:15,162
或者是 outer 的 join

101
00:05:15,353 --> 00:05:17,472
那我們來看一下他

102
00:05:17,497 --> 00:05:21,723
這兩個表跟剛剛都是一樣的

103
00:05:21,748 --> 00:05:23,782
如果說我們採取

104
00:05:23,807 --> 00:05:26,235
的是一種 outer 的 merge 的話

105
00:05:26,258 --> 00:05:27,258
我就會把

106
00:05:27,298 --> 00:05:29,177
這裡的所有資料

107
00:05:29,226 --> 00:05:31,251
全部都把它呈現出來

108
00:05:31,276 --> 00:05:34,035
就是 001 到 004 以及

109
00:05:34,060 --> 00:05:38,202
8 跟 9 這 5 個資料全部呈現出來

110
00:05:38,559 --> 00:05:39,559
但是呢

111
00:05:39,607 --> 00:05:44,715
這些資料裡面有一些資料就會

112
00:05:44,748 --> 00:05:46,153
沒有那個值

113
00:05:46,178 --> 00:05:48,551
例如說 002 的這筆資料

114
00:05:48,750 --> 00:05:50,495
他並沒有 cs 這個的成績

115
00:05:50,520 --> 00:05:51,384
對不對

116
00:05:51,409 --> 00:05:52,931
所以他整併起來以後

117
00:05:52,956 --> 00:05:55,194
這個地方它就不曉得要填什麼

118
00:05:55,219 --> 00:05:56,915
就填上一個 nan

119
00:05:56,940 --> 00:05:58,445
就是空值的意思

120
00:05:58,914 --> 00:06:03,549
那同理啦 這個 003 跟 004 也都是填上 nan

121
00:06:03,807 --> 00:06:06,667
那對 008 的這筆資料來講

122
00:06:06,692 --> 00:06:09,412
他是有 cs 的這個資料的

123
00:06:09,437 --> 00:06:11,182
沒有的是這個 nan

124
00:06:11,293 --> 00:06:13,634
所以這個地方就填上這樣的值

125
00:06:14,157 --> 00:06:17,650
所以我們採取 outer 這個 merge 的時候

126
00:06:17,675 --> 00:06:20,213
記得資料全部都會呈現

127
00:06:20,975 --> 00:06:25,768
現在我們再來看另外一種叫做 left 的這個outer

128
00:06:25,931 --> 00:06:29,656
那 left 的 outer join 怎麼做呢

129
00:06:29,681 --> 00:06:34,890
我左邊的資料都一定要保有

130
00:06:34,915 --> 00:06:38,637
左邊有 1 到 4 嘛 所以 1 到 4 全部都有

131
00:06:38,662 --> 00:06:40,699
那右邊的這個 8 跟 9

132
00:06:40,724 --> 00:06:42,143
我就不呈現出來

133
00:06:42,168 --> 00:06:44,128
所以這個聯集跟交集

134
00:06:44,264 --> 00:06:45,644
都是不一樣

135
00:06:45,954 --> 00:06:50,115
左邊是我主體的資料我要他都呈現出來

136
00:06:50,140 --> 00:06:54,105
即便有一些資料他是有空值的

137
00:06:54,811 --> 00:06:58,128
那 left 的 outer merge 是這個樣子

138
00:06:58,153 --> 00:07:01,152
那一定有 right 的 outer merge 啦

139
00:07:01,415 --> 00:07:03,096
同理呢它就是

140
00:07:03,121 --> 00:07:06,346
我要把右邊的資料全都呈現出來

141
00:07:06,371 --> 00:07:09,878
所以這個地方有 s001 008 009

142
00:07:09,903 --> 00:07:11,804
那一樣 phy 這個地方

143
00:07:11,829 --> 00:07:13,089
它就會空值

144
00:07:13,114 --> 00:07:14,114
填上空值

