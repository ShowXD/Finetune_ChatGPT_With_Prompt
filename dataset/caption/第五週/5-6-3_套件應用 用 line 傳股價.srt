1
00:00:13,402 --> 00:00:17,021
大家好 這一小節我們要來寫一個小小的

2
00:00:17,046 --> 00:00:18,282
理財機器人

3
00:00:18,314 --> 00:00:21,536
用 line 來傳送即時的股價

4
00:00:21,946 --> 00:00:24,107
接續上一個題目呢

5
00:00:24,132 --> 00:00:28,322
我們用 python 去抓取台灣的股價

6
00:00:28,632 --> 00:00:31,070
那我們現在希望能夠

7
00:00:31,095 --> 00:00:33,758
去監控股價的高低

8
00:00:33,790 --> 00:00:36,473
然後來即時的傳送訊息

9
00:00:36,566 --> 00:00:38,806
給我們自己 line 的帳號

10
00:00:38,821 --> 00:00:41,312
這樣我們就可以做一些買賣

11
00:00:41,685 --> 00:00:44,946
那我們不會直接用我們的程式去

12
00:00:44,971 --> 00:00:46,510
呼叫這個 line 的 api

13
00:00:46,535 --> 00:00:50,055
而是透過另一個服務叫做 IFTTT

14
00:00:50,230 --> 00:00:51,764
等一下會介紹

15
00:00:51,972 --> 00:00:54,527
那在這之前我們先來執行一下

16
00:00:54,552 --> 00:00:57,777
讓大家來看一下效果

17
00:00:57,992 --> 00:00:59,277
那這裡的話

18
00:00:59,302 --> 00:01:03,031
我們可以看到說我把花仙子的股價

19
00:01:03,125 --> 00:01:04,755
設定在 50

20
00:01:04,780 --> 00:01:08,510
如果說股價高於 50 的話

21
00:01:08,535 --> 00:01:11,036
它就會用 line 來通知我

22
00:01:11,489 --> 00:01:14,790
那我們先來執行一下這個程式

23
00:01:16,933 --> 00:01:20,518
那執行完了以後這個程式會出現說

24
00:01:20,543 --> 00:01:23,239
小小的理財機器人開始

25
00:01:23,264 --> 00:01:25,489
花仙子的股價是

26
00:01:25,521 --> 00:01:28,745
68.8 下面還有一些訊息

27
00:01:28,778 --> 00:01:31,247
那右邊這個地方各位看到

28
00:01:31,272 --> 00:01:33,747
line 這個地方好像有訊息進來了

29
00:01:33,969 --> 00:01:36,497
okay 那它就會呈現說

30
00:01:36,522 --> 00:01:38,462
花仙子的股價

31
00:01:38,496 --> 00:01:41,065
那前面有一個 IFTTT

32
00:01:41,240 --> 00:01:45,525
那我們就來看這個東西是怎麼做到的

33
00:01:47,525 --> 00:01:48,700
我們剛開始有說過

34
00:01:48,725 --> 00:01:51,898
我們直接用我們這個程式去

35
00:01:52,225 --> 00:01:55,437
呼叫 line 的 api 來傳送訊息的話

36
00:01:55,488 --> 00:01:56,817
是比較麻煩一點

37
00:01:56,859 --> 00:02:03,456
因為你的程式碼需要比較了解 line 的 api 怎麼樣來呼叫

38
00:02:03,481 --> 00:02:06,485
網路上有一個很不錯的服務

39
00:02:06,510 --> 00:02:08,465
叫做 IFTTT

40
00:02:08,490 --> 00:02:13,206
它把跟 line 的 api 溝通的這件事情

41
00:02:13,231 --> 00:02:15,184
已經大部分都做好了

42
00:02:15,209 --> 00:02:17,559
所以你只要呼叫它來做就好了

43
00:02:17,592 --> 00:02:18,725
有點像代理人

44
00:02:18,934 --> 00:02:21,448
或是代書等等的 它會幫你

45
00:02:21,500 --> 00:02:23,188
辦理一些瑣事

46
00:02:23,228 --> 00:02:26,996
所以你只要傳個訊息帶一些參數給它

47
00:02:27,021 --> 00:02:30,205
它就把剩下的細節幫你做好

48
00:02:30,445 --> 00:02:33,926
那這個 IFTTT 它的全名叫做

49
00:02:33,951 --> 00:02:35,680
IF This Then That

50
00:02:35,712 --> 00:02:37,786
所以叫做 IFTTT

51
00:02:38,203 --> 00:02:39,389
那基本上

52
00:02:39,873 --> 00:02:41,928
它有非常多的應用

53
00:02:41,953 --> 00:02:45,178
先點進來看一下它的服務

54
00:02:45,203 --> 00:02:46,203


55
00:02:48,685 --> 00:02:51,414
進來了以後你可以

56
00:02:51,439 --> 00:02:54,632
在帳號的部分你可以去申請一個

57
00:02:54,657 --> 00:02:56,669
或者是用 google facebook

58
00:02:56,694 --> 00:02:59,384
它都有跟它們帳號去做一個整合

59
00:02:59,703 --> 00:03:03,439
那因為我已經有寫了一些 Applets

60
00:03:03,464 --> 00:03:05,313
所以我就直接點進來

61
00:03:05,514 --> 00:03:08,675
那所謂的 applets 就是小應用程式的意思

62
00:03:08,700 --> 00:03:11,089
我這裡的每一個設定呢

63
00:03:11,114 --> 00:03:13,862
它都把它當成是一個小程式

64
00:03:13,887 --> 00:03:16,116
基本上這一些小程式呢

65
00:03:16,141 --> 00:03:18,368
是通過設定就可以完成的

66
00:03:18,393 --> 00:03:20,339
那我舉個例子來講

67
00:03:21,363 --> 00:03:25,046
例如我想要每一天早上 11:55

68
00:03:25,071 --> 00:03:28,763
傳送訊息跟我報一下今天天氣如何

69
00:03:29,125 --> 00:03:33,850
那就可以用這個 applet 來幫我做這個事情

70
00:03:33,875 --> 00:03:37,061
或者是下面這個 applet 它是

71
00:03:37,129 --> 00:03:40,354
NASA 所提供的一個服務

72
00:03:40,379 --> 00:03:42,847
如果 NASA 有一些重大的訊息

73
00:03:42,880 --> 00:03:45,025
它就會寄 Email 給我

74
00:03:45,444 --> 00:03:46,073
okay

75
00:03:46,153 --> 00:03:49,589
那像這一個服務也是跟天氣相關的

76
00:03:49,614 --> 00:03:51,923
如果明天

77
00:03:52,615 --> 00:03:54,059
會下雨的話

78
00:03:54,084 --> 00:03:58,043
它就送給我一個通知

79
00:03:58,068 --> 00:04:01,464
所以各位可以發現這個 IFTTT

80
00:04:01,497 --> 00:04:03,798
它都會用到兩個服務

81
00:04:03,838 --> 00:04:07,726
左上角這個地方就是一個它的條件

82
00:04:08,111 --> 00:04:11,150
這個條件滿足的時候

83
00:04:11,175 --> 00:04:12,563
它會做下面這個事情

84
00:04:12,588 --> 00:04:16,221
所以才叫做 IF This Then That

85
00:04:17,674 --> 00:04:21,800
這個 This 跟 That 它都是一些服務所構成的

86
00:04:21,825 --> 00:04:25,705
所以我們點一下右邊這個地方有一個 Service

87
00:04:25,824 --> 00:04:29,523
這裡的 Service 包含像 Email

88
00:04:29,619 --> 00:04:33,554
IFTTT 本身也可以是個 Service

89
00:04:33,579 --> 00:04:39,856
Line,Notification,Space 還有天氣相關的

90
00:04:39,881 --> 00:04:42,134
還有 Webhooks 等等的

91
00:04:42,312 --> 00:04:45,537
我們等一下就是會用到 Webhooks

92
00:04:45,562 --> 00:04:48,954
那 Webhooks 其實你可以把它想像成是

93
00:04:48,979 --> 00:04:52,128
一個網頁的微接口

94
00:04:52,153 --> 00:04:52,938
所以呢

95
00:04:53,026 --> 00:04:57,772
等一下我們就可以透過這個地方來去產生一個事件

96
00:04:57,907 --> 00:05:00,660
所以呢我們在 IF This 的那個 This

97
00:05:00,685 --> 00:05:02,489
就是設定一個事件

98
00:05:02,514 --> 00:05:05,242
那我們的程式去呼叫這個事件的話

99
00:05:05,267 --> 00:05:10,576
那個 This 就會滿足然後做 That 的部分

100
00:05:10,767 --> 00:05:14,241
那我們現在就來增加一個 applet

101
00:05:14,266 --> 00:05:17,473
我們就先點一下 new 一個 applet

102
00:05:18,246 --> 00:05:20,224
增加一個 applet

103
00:05:20,249 --> 00:05:21,970
那我們這個 applet

104
00:05:21,995 --> 00:05:24,931
我們剛剛說了我們要透過 webhook

105
00:05:24,956 --> 00:05:26,463
來幫我們做這件事情

106
00:05:26,488 --> 00:05:30,217
所以我們就在這個地方加上一個 webhooks

107
00:05:30,508 --> 00:05:33,127
那接下來要去設定它

108
00:05:33,152 --> 00:05:34,388
那我們要給一個名子啦

109
00:05:34,413 --> 00:05:38,333
剛剛我們已經是有一個叫 stockLine

110
00:05:38,358 --> 00:05:41,920
那我這裡故意把它叫 stockLine2 這樣子

111
00:05:42,079 --> 00:05:46,434
那去 Create trigger 產生一個觸發器

112
00:05:46,990 --> 00:05:49,143
點擊完了以後這個

113
00:05:49,172 --> 00:05:51,438
This 的部分就已經設定好了

114
00:05:51,463 --> 00:05:54,160
要 then that,that 的部分呢

115
00:05:54,185 --> 00:05:58,217
我們是要傳送一個 line 的訊息

116
00:05:58,242 --> 00:06:00,412
我們就在這個地方建立一個 line

117
00:06:00,437 --> 00:06:03,367
那我再進去設定它

118
00:06:04,698 --> 00:06:06,859
這時候它就會問你說

119
00:06:06,884 --> 00:06:08,398
這個接收端是誰

120
00:06:08,448 --> 00:06:09,964
那一般來講就是

121
00:06:09,989 --> 00:06:12,392
預設就是 line 的 notify

122
00:06:12,417 --> 00:06:16,426
line 的 notify 你可以把它想像成就是

123
00:06:16,451 --> 00:06:20,148
你 line 裡面的一個使用者

124
00:06:20,173 --> 00:06:22,858
像一個機器人你可以跟它對話

125
00:06:22,890 --> 00:06:25,831
不過它其實就是來發送訊息

126
00:06:25,856 --> 00:06:30,161
所以你可以點進這個地方來看一些訊息

127
00:06:30,186 --> 00:06:33,632
那你也可以邀請這個人到你其它的群組裡面

128
00:06:33,657 --> 00:06:35,443
這也是可以的

129
00:06:36,110 --> 00:06:39,888
那這個地方我們要傳送 line 的訊息給它的時候

130
00:06:39,913 --> 00:06:41,664
可以帶一些參數麻

131
00:06:41,689 --> 00:06:44,173
像我們剛剛講的就是股價這樣子

132
00:06:44,198 --> 00:06:47,086
那因為我們只有股票一個參數

133
00:06:47,111 --> 00:06:50,615
所以我們可以把這個地方刪掉就是帶第一個

134
00:06:50,640 --> 00:06:53,324
那注意到 [[ ]] 這個地方呢

135
00:06:54,421 --> 00:06:57,370
裡面寫這個 value1 到時候就會看

136
00:06:57,395 --> 00:06:58,746
股價是等於多少

137
00:06:58,771 --> 00:07:00,786
就會存這個地方

138
00:07:00,811 --> 00:07:03,376
那前面這個地方就是一些提示字

139
00:07:03,401 --> 00:07:05,611
所以我們這個地方就可以寫說

140
00:07:05,850 --> 00:07:09,100
股價為 : 這樣子

141
00:07:09,125 --> 00:07:12,977
這樣它就會來傳送這樣子的訊息

142
00:07:13,002 --> 00:07:16,289
我們就把這一個 create 出來

143
00:07:16,314 --> 00:07:17,314
這樣就好了

144
00:07:18,669 --> 00:07:24,089
那記得這個地方要點一下 finish

145
00:07:26,604 --> 00:07:29,591
那我們現在回到我們的 applet

146
00:07:29,616 --> 00:07:33,558
最後可以看到我們已經新增了一個 stockLine2

147
00:07:33,583 --> 00:07:36,090
這樣的一個小程式

148
00:07:37,353 --> 00:07:40,060
如果大家是第一次建立的時候呢

149
00:07:40,085 --> 00:07:42,064
必須要去做一個綁定

150
00:07:42,089 --> 00:07:44,633
因為我們會用到這兩個服務麻

151
00:07:44,658 --> 00:07:46,729
一個是 webhook 一個是 line

152
00:07:46,754 --> 00:07:49,291
那我們可以先在 service 這個地方

153
00:07:49,721 --> 00:07:51,500
點一下這個 line

154
00:07:52,119 --> 00:07:54,571
line 這個地方你要去做一個綁定

155
00:07:54,596 --> 00:07:57,658
所以可以在 setting 這個地方點一下

156
00:07:57,683 --> 00:07:59,730
各位可以看到說

157
00:07:59,777 --> 00:08:01,975
我是已經綁訂好了

158
00:08:02,000 --> 00:08:04,453
那如果說你不想綁定的話

159
00:08:04,478 --> 00:08:05,762
就是把它做個 disconnect

160
00:08:05,787 --> 00:08:09,016
再去重新綁定一下就 ok 了

161
00:08:09,623 --> 00:08:12,970
另外在 webhook 這個地方

162
00:08:16,964 --> 00:08:19,424
webhook 這個地方也是一樣

163
00:08:19,449 --> 00:08:21,138
你進來了以後

164
00:08:21,163 --> 00:08:22,861
也是要做一些設定

165
00:08:23,368 --> 00:08:25,760
那像我這個地方已經設定好了

166
00:08:25,785 --> 00:08:27,764
系統就會給我一個 id

167
00:08:27,790 --> 00:08:31,518
像這個 bl 這個 id

168
00:08:31,543 --> 00:08:34,019
我是必須要記著的 因為

169
00:08:34,044 --> 00:08:36,821
我們的程式碼等一下會用到

170
00:08:37,826 --> 00:08:41,269
接下來我們就來看程式怎麼寫

171
00:08:41,294 --> 00:08:45,492
那前面我們必須要 import 一個是台灣的股票

172
00:08:45,508 --> 00:08:49,686
另外一個是我要去做網頁訊息的發送

173
00:08:49,711 --> 00:08:51,845
所以要去 import request

174
00:08:52,525 --> 00:08:57,988
那首先我們必須先把 webhook 的網址建構起來

175
00:08:58,165 --> 00:09:00,012
那這個網址是長這個樣子

176
00:09:00,037 --> 00:09:05,323
就是 https://maker.ifttt.com/trigger/

177
00:09:05,348 --> 00:09:07,109
那 {}/with/key/{} 這裡面有兩個參數

178
00:09:07,134 --> 00:09:10,736
那第一個參數就是你的事件的名稱

179
00:09:10,764 --> 00:09:18,459
第二個就是你在 IFTTT 上建立的 webhook id

180
00:09:18,484 --> 00:09:22,840
所以我們用這個 format 的方式把他綁起來

181
00:09:23,214 --> 00:09:24,937
那這個網址要不要記呢

182
00:09:24,962 --> 00:09:25,951
其實也不用

183
00:09:25,984 --> 00:09:31,697
各位可以到剛剛 IFTTT 這個地方

184
00:09:31,722 --> 00:09:34,444
找到 webhook 這個 service

185
00:09:34,720 --> 00:09:36,945
我們剛剛是在設定這個地方

186
00:09:36,970 --> 00:09:39,918
左邊這裡有個 documentation 點一下

187
00:09:41,020 --> 00:09:42,671
就可以看到這一串網址了

188
00:09:42,696 --> 00:09:44,632
這一串網址它說

189
00:09:44,657 --> 00:09:47,869
你可以用一個 POST 或者是一個 GET

190
00:09:47,894 --> 00:09:50,434
web request 去做這件事情

191
00:09:50,745 --> 00:09:53,934
所以你可以把這串網址複製下來

192
00:09:54,594 --> 00:09:56,498
我們回到程式碼

193
00:09:56,523 --> 00:09:59,644
記得要把這兩個參數設定對

194
00:09:59,928 --> 00:10:01,918
那其他的部分就是

195
00:10:01,943 --> 00:10:03,887
抓股票資訊的部分

196
00:10:03,912 --> 00:10:05,664
那我們回到這個地方來

197
00:10:06,083 --> 00:10:09,494
這裡因為我們要去傳送股價的資訊

198
00:10:09,519 --> 00:10:11,765
所以有一個參數就是價格

199
00:10:11,917 --> 00:10:14,392
這時候呢我們就是用一個問號

200
00:10:14,417 --> 00:10:16,386
value1 等於多少

201
00:10:16,411 --> 00:10:20,893
那當然這一個 realprice 就是股價的資訊嘛

202
00:10:21,958 --> 00:10:25,864
也是對應到我們剛剛在 IFTTT 裡面的設定

203
00:10:25,889 --> 00:10:27,696
再回來在看一下

204
00:10:29,115 --> 00:10:31,042
我們剛剛在這個地方呢

205
00:10:33,185 --> 00:10:36,606
這裡有一個 value1

206
00:10:36,631 --> 00:10:40,114
所以這個 value1 它就會對應到我們這個程式

207
00:10:40,670 --> 00:10:43,098
這個地方 value1 就會帶過去

208
00:10:43,225 --> 00:10:47,611
我們現在是把這個 URL 稍微印出來給大家看一下

209
00:10:47,645 --> 00:10:49,112
這個網址呢

210
00:10:49,263 --> 00:10:50,263
它長的樣子就會像這個樣子

211
00:10:55,960 --> 00:10:59,830
那就透過 request.get 去發送這樣子的訊息

212
00:10:59,855 --> 00:11:05,785
這樣我們就可以在 line 即時收到股價的資訊

